trigger:
  - none

schedules:
- cron: "0 4 * * *"
  displayName: Daily Midnight Build
  branches:
    include:
    - master
  always: true

pr:
  - none

pool:
  vmImage: 'ubuntu-latest'

variables:
  - name: IMAGERESORUCEGROUP
    value: aib-sig-rg
  - name: IMAGETEMPLATEFILENAME
    value: image-template-win-10.json
  - name: IMAGERESOURCENAME
    value: 01-image-template-win-10-desktop

steps:
- checkout: self
  displayName: Clone Git Repo

- task: Bash@3
  displayName: List Git Repo Content
  inputs:
    targetType: 'inline'
    script: 'ls -al'

- task: Bash@3
  displayName: Configure Image Template
  inputs:
    filePath: '00-configure-image-template.sh'

- task: Bash@3
  displayName: Log Image Template
  inputs:
    targetType: 'inline'
    script: 'cat ${IMAGETEMPLATEFILENAME}'

- task: AzureCLI@2
  displayName: Create Image Template
  inputs:
    azureSubscription: 'AzDevOPS'
    scriptType: 'bash'
    scriptLocation: 'scriptPath'
    scriptPath: '01-create-image-template.sh'

- task: AzureCLI@2
  displayName: Build Image
  inputs:
    azureSubscription: 'AzDevOPS'
    scriptType: 'bash'
    scriptLocation: 'scriptPath'
    scriptPath: '02-build-image.sh'

- task: AzureCLI@2
  displayName: Delete Image Template
  inputs:
    azureSubscription: 'AzDevOPS'
    scriptType: 'bash'
    scriptLocation: 'scriptPath'
    scriptPath: '03-delete-image-template.sh'